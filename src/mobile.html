<!DOCTYPE html>
<html>
  <head>
    <title>GATEKEEPER &middot; Wrong Planet</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta
      name="description"
      content="Winamp reimplemented in HTML5 and JavaScript"
    />
    <meta property="og:title" content="GATEKEEPER &bull; Wrong Planet" />
    <meta
      property="og:description"
      content="Winamp reimplemented in HTML5 and JavaScript"
    />
    <meta property="og:type" content="website" />
    <meta property="og:url" content="https://webamp.org" />

    <meta property="og:image" content="./images/preview.png" />
    <link rel="shortcut icon" sizes="16x16 32x32" href="/assets/favicon-BX6eJgec.ico" />

    <!-- See https://goo.gl/qRE0vM -->
    <meta name="theme-color" content="#4b4b4b" />

    <meta
      name="google-site-verification"
      content="ycocEnfUpYf8u_UmzpqSe0gNooPs0PBjbD7HKw-qa5I"
    />
    
    <!-- Use CDN Webamp instead of local bundle -->
    <script src="https://unpkg.com/webamp@1.5.0/built/webamp.bundle.min.js"></script>
    
    <script>
      // GATEKEEPER tracks for initialization
      const GATEKEEPER_TRACKS = [
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753891932/01_Gross_Excalations_v3.mp3",
          duration: 68.784,
          metaData: { title: "Gross Excelations" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753891952/02_Two_Travelers_v3.mp3", 
          duration: 208.152,
          metaData: { title: "Two Travelers" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753891962/03_Chambers_of_the_Starwatcher_v3.mp3",
          duration: 218.5665,
          metaData: { title: "Chambers of the Starwatcher" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753891972/04_Hibernal_Torment_v3.mp3",
          duration: 216,
          metaData: { title: "Hibernal Torment" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753892009/05_Rats_v3.mp3",
          duration: 233.64,
          metaData: { title: "Rats" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753892029/06_Entrusted_to_Fools_v3.mp3",
          duration: 196.008,
          metaData: { title: "Entrusted to Fools" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753892049/07_Heavy_Load_v3.mp3",
          duration: 192,
          metaData: { title: "Spider Wash" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753893189/08_Crusted_Aucklet_v3.mp3",
          duration: 71.016,
          metaData: { title: "Crusted Aucklet" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753893209/09_Ill_Wind_v3.mp3",
          duration: 216,
          metaData: { title: "Ill Wind" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753893229/10_Breadmaker_v3.mp3",
          duration: 193.824,
          metaData: { title: "Rippler" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753893249/11_Doom_Fruit_v3.mp3",
          duration: 210,
          metaData: { title: "Trapped in a Tree" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753894796/12_Taste_of_my_Chime_v3.mp3",
          duration: 138,
          metaData: { title: "Taste of my Chime" }
        },
        {
          url: "https://res.cloudinary.com/dtwix3ubl/video/upload/v1753894816/13_Bone_Window_v3.mp3",
          duration: 141.648,
          metaData: { title: "Bone Window" }
        }
      ];
      
      // Initialize Webamp with our custom tracks
      window.addEventListener('DOMContentLoaded', async () => {
        console.log('Initializing Webamp with GATEKEEPER tracks...');
        
        try {
          // Wait for Webamp to be available
          while (!window.Webamp) {
            console.log('Waiting for Webamp to load...');
            await new Promise(resolve => setTimeout(resolve, 100));
          }
          
          console.log('Webamp loaded, creating instance...');
          
          // Load custom skin if available
          let skinUrl = null;
          try {
            const response = await fetch('./assets/skins/GKSkin.wsz');
            if (response.ok) {
              const blob = await response.blob();
              skinUrl = URL.createObjectURL(blob);
              console.log('Custom skin loaded');
            }
          } catch (e) {
            console.log('Using default skin:', e.message);
          }
          
          // Initialize Webamp with our tracks and settings
          const webamp = new window.Webamp({
            initialTracks: GATEKEEPER_TRACKS,
            initialSkin: skinUrl ? { url: skinUrl } : undefined,
            enableHotkeys: true,
            zIndex: 10000
          });
          
          // Store webamp instance globally for debugging
          window.webampInstance = webamp;
          
          // Render Webamp
          await webamp.renderWhenReady(document.body);
          
          console.log('Webamp initialized successfully!');
          console.log('Available methods:', Object.getOwnPropertyNames(webamp).filter(name => typeof webamp[name] === 'function'));
          
          // Show the logo after Webamp is ready
          setTimeout(() => {
            const logoLink = document.getElementById('legendarium-logo-link');
            if (logoLink) {
              logoLink.classList.add('visible');
              startLegendariumLogoAnimation();
            }
          }, 1000);
          
          // Fix seek bar functionality
          fixSeekBarFunctionality(webamp);
          
        } catch (error) {
          console.error('Error initializing Webamp:', error);
          console.log('Falling back to basic initialization...');
          
          // Fallback: try basic initialization
          if (window.Webamp) {
            const webamp = new window.Webamp();
            await webamp.renderWhenReady(document.body);
            
            // Try to append tracks after initialization
            setTimeout(() => {
              try {
                if (webamp.appendTracks) {
                  webamp.appendTracks(GATEKEEPER_TRACKS);
                  console.log('Tracks appended via fallback');
                }
              } catch (e) {
                console.error('Fallback track loading failed:', e);
              }
            }, 2000);
          }
        }
      });
      
      // Starfield System (simplified from desktop version)
      class StarField {
        constructor() {
          this.canvas = document.getElementById('starfield-canvas');
          this.ctx = this.canvas.getContext('2d');
          this.stars = [];
          this.time = 0;
          this.resize();
          this.createStars(600); // Fewer stars for mobile performance
          window.addEventListener('resize', () => this.resize());
          requestAnimationFrame((t) => this.animate(t));
        }
        
        resize() {
          this.width = window.innerWidth;
          this.height = window.innerHeight;
          this.canvas.width = this.width;
          this.canvas.height = this.height;
          this.centerX = this.width / 2;
          this.centerY = this.height / 2;
        }
        
        createStars(count) {
          const maxDist = Math.sqrt(Math.pow(this.width / 2, 2) + Math.pow(this.height / 2, 2));
          
          for (let i = 0; i < count; i++) {
            const angle = Math.random() * Math.PI * 2;
            const initialDistance = Math.random() * maxDist;
            
            this.stars.push({
              angle: angle,
              size: (Math.random() * 1.5 + 0.375),
              speed: Math.random() * 0.5 + 0.1,
              brightness: Math.random() * 1.8 + 0.6,
              twinkleSpeed: Math.random() * 2.1 + 0.02,
              twinklePhase: Math.random() * Math.PI * 2,
              glowPhase: Math.random() < 0.3 ? Math.random() * Math.PI * 2 : undefined,
              x: this.centerX + Math.cos(angle) * initialDistance,
              y: this.centerY + Math.sin(angle) * initialDistance
            });
          }
        }
        
        animate(timestamp) {
          this.time = timestamp * 0.001;
          this.ctx.fillStyle = 'black';
          this.ctx.fillRect(0, 0, this.width, this.height);
          
          this.stars.forEach(star => {
            // Move star
            star.x += Math.cos(star.angle) * star.speed;
            star.y += Math.sin(star.angle) * star.speed;
            
            // Reset if off screen
            if (star.x < 0 || star.x > this.width || star.y < 0 || star.y > this.height) {
              star.x = this.centerX;
              star.y = this.centerY;
              star.angle = Math.random() * Math.PI * 2;
            }
            
            // Draw star with simplified glow for mobile performance
            let distance = Math.sqrt(Math.pow(star.x - this.centerX, 2) + Math.pow(star.y - this.centerY, 2));
            let maxDistance = Math.sqrt(Math.pow(this.width / 2, 2) + Math.pow(this.height / 2, 2));
            let opacity = distance / maxDistance * 1.5;
            
            let twinkleBase = Math.sin(this.time * star.twinkleSpeed * 2 + star.twinklePhase);
            let twinkle = Math.pow(Math.max(0, twinkleBase * 0.5 + 0.5), 4.5) * 0.95 + 0.05;
            
            let randomGlow = 1.0;
            if (star.glowPhase !== undefined) {
              let glowCycle = Math.sin(this.time * 0.3 + star.glowPhase);
              randomGlow = glowCycle > 0.7 ? 1.0 + (glowCycle - 0.7) * 2.0 : 1.0;
            }
            
            opacity = Math.min(opacity * star.brightness * twinkle * randomGlow, 1);
            
            if (opacity > 0) {
              this.ctx.fillStyle = `rgba(255,255,255,${opacity})`;
              this.ctx.beginPath();
              this.ctx.arc(star.x, star.y, star.size, 0, Math.PI * 2);
              this.ctx.fill();
              
              // Simplified glow for mobile
              if (opacity > 0.3) {
                this.ctx.globalAlpha = opacity * 0.4;
                this.ctx.shadowColor = 'rgba(255,255,255,0.8)';
                this.ctx.shadowBlur = star.size * 3;
                this.ctx.beginPath();
                this.ctx.arc(star.x, star.y, star.size * 1.2, 0, Math.PI * 2);
                this.ctx.fill();
                this.ctx.globalAlpha = 1;
                this.ctx.shadowBlur = 0;
              }
            }
          });
          
          requestAnimationFrame((t) => this.animate(t));
        }
      }
      
      // Logo animation
      function startLegendariumLogoAnimation() {
        const logo = document.getElementById('legendarium-logo');
        if (!logo) return;
        
        let start = null;
        let isHovered = false;
        
        const logoLink = document.getElementById('legendarium-logo-link');
        logoLink.addEventListener('mouseenter', () => isHovered = true);
        logoLink.addEventListener('mouseleave', () => isHovered = false);
        
        function animate(ts) {
          if (!start) start = ts;
          const t = (ts - start) / 1000;
          
          if (!isHovered) {
            const orbitRadiusX = 4;
            const orbitRadiusY = 2;
            const orbitSpeed = 0.15;
            const angle = t * orbitSpeed;
            const x = Math.cos(angle) * orbitRadiusX;
            const y = Math.sin(angle) * orbitRadiusY;
            const spin = Math.sin(t * 0.25) * 90;
            logo.style.transform = `translate(${x}px, ${y}px) rotateY(${spin}deg)`;
          }
          requestAnimationFrame(animate);
        }
        requestAnimationFrame(animate);
      }
      
      // Fix seek bar functionality
      function fixSeekBarFunctionality(webamp) {
        // Wait a moment for Webamp to fully initialize
        setTimeout(() => {
          try {
            // Find the position bar element
            const positionBar = document.querySelector('#webamp #position');
            if (positionBar) {
              console.log('Found position bar, adding seek functionality');
              
              // Remove any existing listeners
              positionBar.onmousedown = null;
              positionBar.onmouseup = null;
              positionBar.ontouchstart = null;
              positionBar.ontouchend = null;
              
              // Add proper seek functionality
              const addSeekListener = (startEvent, endEvent) => {
                positionBar.addEventListener(startEvent, (e) => {
                  const rect = positionBar.getBoundingClientRect();
                  const clickX = (e.clientX || e.touches[0].clientX) - rect.left;
                  const percentage = clickX / rect.width;
                  
                  // Store the seek percentage for when mouse/touch is released
                  positionBar._seekPercentage = Math.max(0, Math.min(1, percentage));
                });
                
                positionBar.addEventListener(endEvent, (e) => {
                  if (positionBar._seekPercentage !== undefined) {
                    const percentage = positionBar._seekPercentage;
                    
                    // Get current track duration
                    const state = webamp.getState();
                    const currentTrack = state.playlist.currentTrack;
                    const tracks = state.tracks;
                    
                    if (currentTrack !== null && tracks[currentTrack] && tracks[currentTrack].duration) {
                      const duration = tracks[currentTrack].duration;
                      const seekTime = duration * percentage;
                      
                      console.log(`Seeking to ${percentage * 100}% (${seekTime}s of ${duration}s)`);
                      
                      // Use Webamp's seekToTime method
                      if (webamp.seekToTime) {
                        webamp.seekToTime(seekTime);
                      }
                    }
                    
                    delete positionBar._seekPercentage;
                  }
                });
              };
              
              // Add both mouse and touch listeners
              addSeekListener('mousedown', 'mouseup');
              addSeekListener('touchstart', 'touchend');
              
            } else {
              console.log('Position bar not found, retrying...');
              // Retry after a delay
              setTimeout(() => fixSeekBarFunctionality(webamp), 1000);
            }
          } catch (error) {
            console.error('Error fixing seek bar:', error);
          }
        }, 500);
      }
      
      // Initialize starfield when page loads
      let starField;
      window.addEventListener('DOMContentLoaded', () => {
        console.log('Initializing starfield...');
        starField = new StarField();
      });
    </script>
    <style>
      /* Starfield Background */
      #starfield-canvas {
        position: fixed;
        top: 0;
        left: 0;
        width: 100vw;
        height: 100vh;
        z-index: -1;
        pointer-events: none;
        background: #000;
      }
      
      body {
        margin: 0;
        padding: 0;
        background-color: #000;
      }
      
      /* Legendarium Logo */
      #legendarium-logo-link {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        z-index: 1;
        opacity: 0;
        transition: opacity 1s ease-in-out;
      }
      
      #legendarium-logo-link.visible {
        opacity: 1;
      }
      
      #legendarium-logo {
        width: 120px;
        height: 120px;
        filter: brightness(0.8) drop-shadow(0 0 10px rgba(255,255,255,0.3));
        transition: filter 0.3s ease;
      }
      
      #legendarium-logo:hover {
        filter: brightness(1.2) drop-shadow(0 0 20px rgba(255,255,255,0.6));
      }
    </style>
  </head>
  <body>
    <!-- Starfield Background -->
    <canvas id="starfield-canvas"></canvas>
    
    <!-- Legendarium Logo -->
    <a id="legendarium-logo-link" href="https://legendarium.nyc" target="_blank" rel="noopener">
        <img id="legendarium-logo" src="assets/images/Legendarium-Logo-Trans-1.png" alt="Legendarium Logo">
    </a>
    
    <div id="app">
      <div id="loading" style="display: none">
        Loading<span class="ellipsis-anim"
          ><span>.</span><span>.</span><span>.</span></span
        >
      </div>
    </div>
    <div id="browser-compatibility">
      <p>Your browser does not support the features we need.</p>
      <p>
        Try using the most recent version of Chrome, Firefox, Safari or Edge.
      </p>
    </div>
    <div id="demo-desktop"></div>
    <p class="about">
      <a
        target="_blank"
        href="https://github.com/jberg/butterchurn"
        id="butterchurn-share"
        style="background-image: url('./assets/butterchurn-bg-C7adYSab.png')"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 72.767 72.766">
          <path
            d="M72.163,34.225C71.6,33.292,58.086,11.352,37.48,11.352h-2.195c-20.605,0-34.117,21.94-34.681,22.873
              c-0.805,1.323-0.805,2.993,0,4.316c0.564,0.94,14.076,22.873,34.682,22.873h2.195c20.604,0,34.118-21.933,34.683-22.873
              C72.968,37.218,72.968,35.548,72.163,34.225z M37.48,53.141h-2.195c-12.696,0-22.625-11.793-26.242-16.758
              c3.621-4.971,13.546-16.758,26.242-16.758h2.195c12.7,0,22.632,11.802,26.246,16.766C60.125,41.363,50.237,53.141,37.48,53.141z
               M36.383,29.66c-3.666,0-6.633,3.016-6.633,6.724c0,3.716,2.967,6.725,6.633,6.725c3.664,0,6.635-3.009,6.635-6.725
              C43.018,32.675,40.047,29.66,36.383,29.66z"
          />
        </svg>
      </a>
      <a
        target="_blank"
        href="https://github.com/captbaritone/webamp/blob/master/packages/webamp/docs/music-credits.md"
        id="music-credits"
      >
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512">
          <path
            d="M160 64v257.6c-8.2-2.7-17.2-4.1-26.6-4.1-38.3 0-69.4 27.1-69.4 65.4 0 38.3 31.1 65.1 69.4 65.1 38.3 0 69.6-28.2 69.6-69.1V200h202v121.6c-8.2-2.7-17.2-4.1-26.6-4.1-38.3 0-69.4 27.1-69.4 65.4 0 38.3 31.1 65.1 69.4 65.1 38.3 0 69.6-28.2 69.6-69.1V64H160zm245 96H203v-53h202v53z"
          />
        </svg>
      </a>
      <a
        target="_blank"
        href="https://github.com/captbaritone/webamp"
        id="github-share"
      >
        <svg
          aria-labelledby="simpleicons-github-icon"
          role="img"
          viewBox="0 0 24 24"
          xmlns="http://www.w3.org/2000/svg"
        >
          <title id="github">GitHub icon</title>
          <path
            d="M12 .297c-6.63 0-12 5.373-12 12 0 5.303 3.438 9.8 8.205 11.385.6.113.82-.258.82-.577 0-.285-.01-1.04-.015-2.04-3.338.724-4.042-1.61-4.042-1.61C4.422 18.07 3.633 17.7 3.633 17.7c-1.087-.744.084-.729.084-.729 1.205.084 1.838 1.236 1.838 1.236 1.07 1.835 2.809 1.305 3.495.998.108-.776.417-1.305.76-1.605-2.665-.3-5.466-1.332-5.466-5.93 0-1.31.465-2.38 1.235-3.22-.135-.303-.54-1.523.105-3.176 0 0 1.005-.322 3.3 1.23.96-.267 1.98-.399 3-.405 1.02.006 2.04.138 3 .405 2.28-1.552 3.285-1.23 3.285-1.23.645 1.653.24 2.873.12 3.176.765.84 1.23 1.91 1.23 3.22 0 4.61-2.805 5.625-5.475 5.92.42.36.81 1.096.81 2.22 0 1.606-.015 2.896-.015 3.286 0 .315.21.69.825.57C20.565 22.092 24 17.592 24 12.297c0-6.627-5.373-12-12-12"
          />
        </svg>
      </a>
    </p>
    <script>
      (function (i, s, o, g, r, a, m) {
        i["GoogleAnalyticsObject"] = r;
        (i[r] =
          i[r] ||
          function () {
            (i[r].q = i[r].q || []).push(arguments);
          }),
          (i[r].l = 1 * new Date());
        (a = s.createElement(o)), (m = s.getElementsByTagName(o)[0]);
        a.async = 1;
        a.src = g;
        m.parentNode.insertBefore(a, m);
      })(
        window,
        document,
        "script",
        "//www.google-analytics.com/analytics.js",
        "ga"
      );

      ga("create", "UA-96948-19", "auto");
      ga("set", "anonymizeIp", true);
      ga("send", "pageview");
    </script>
    <script type="text/javascript">
      // If we can load faster than half a second, don't bother showing the loading indicator.
      setTimeout(function () {
        var loading = document.getElementById("loading");
        if (loading != null) {
          loading.style.display = "block";
        }
      }, 500);
    </script>
  </body>
</html>